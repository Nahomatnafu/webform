{% extends "base.html" %}

{% block content %}
<style>
    /* Hide the login button on the form page */
    .throttlex-header .header-right {
        display: none;
    }
</style>
<div class="id-form-wrapper">
    <div class="id-form-header">
        <h1 class="form-card-title">ID Information Form</h1>
        <p class="form-card-subtitle">Please fill out all required information for your digital ID application</p>
    </div>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-info" role="alert">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" novalidate enctype="multipart/form-data">
        {{ form.hidden_tag() }}

        <!-- Left Card -->
        <div class="form-card id-form-card">
            <!-- Upload Section -->
            <div class="id-form-section">
                <label class="id-form-label">Upload <span class="required">*</span></label>
                <div class="file-upload-wrapper">
                    {{ form.image(class="file-input", accept="image/*") }}
                    <label for="{{ form.image.id }}" class="file-upload-label">
                        Choose File
                    </label>
                    <span class="file-name">No file chosen</span>
                </div>
                <!-- Image Preview -->
                <div id="image-preview-container" style="display: none; margin-top: 15px;">
                    <img id="image-preview" src="" alt="Image preview" style="max-width: 300px; max-height: 300px; border-radius: 8px; border: 2px solid #D0D0D0;">
                </div>
                {% if form.image.errors %}
                    {% for error in form.image.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- Name Fields (Vertical) -->
            <div class="id-form-field">
                <label class="id-form-label">First Name <span class="required">*</span></label>
                {{ form.first_name(class="id-form-input", placeholder="Enter your first name") }}
                {% if form.first_name.errors %}
                    {% for error in form.first_name.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <div class="id-form-field">
                <label class="id-form-label">Middle Name</label>
                {{ form.middle_name(class="id-form-input", placeholder="Enter your middle name") }}
                {% if form.middle_name.errors %}
                    {% for error in form.middle_name.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <div class="id-form-field">
                <label class="id-form-label">Last Name <span class="required">*</span></label>
                {{ form.last_name(class="id-form-input", placeholder="Enter your last name") }}
                {% if form.last_name.errors %}
                    {% for error in form.last_name.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- Height, Weight, Gender (3 columns) -->
            <div class="id-form-row">
                <div class="id-form-field">
                    <label class="id-form-label">Height <span class="required">*</span></label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div style="flex: 1;">
                            <input type="number" id="height-feet" class="id-form-input" placeholder="5" min="0" max="8" step="1" style="text-align: center;">
                            <small style="display: block; text-align: center; margin-top: 4px; color: #666;">feet</small>
                        </div>
                        <div style="flex: 1;">
                            <input type="number" id="height-inches" class="id-form-input" placeholder="8" min="0" max="11" step="1" style="text-align: center;">
                            <small style="display: block; text-align: center; margin-top: 4px; color: #666;">inches</small>
                        </div>
                    </div>
                    {{ form.height(id="height-cm-hidden", style="display: none;") }}
                    {% if form.height.errors %}
                        {% for error in form.height.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="id-form-field">
                    <label class="id-form-label">Weight <span class="required">*</span></label>
                    {{ form.weight(class="id-form-input", placeholder="150 lbs") }}
                    {% if form.weight.errors %}
                        {% for error in form.weight.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="id-form-field">
                    <label class="id-form-label">Gender <span class="required">*</span></label>
                    {{ form.gender(class="id-form-select") }}
                    {% if form.gender.errors %}
                        {% for error in form.gender.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        

        <!-- Right Card -->
        
            <!-- State Dropdown -->
            <div class="id-form-section">
                <label class="id-form-label">State <span class="required">*</span></label>
                {{ form.state(class="id-form-select") }}
                {% if form.state.errors %}
                    {% for error in form.state.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- Eye Color Dropdown -->
            <div class="id-form-section">
                <label class="id-form-label">Eye Color <span class="required">*</span></label>
                {{ form.eye_color(class="id-form-select") }}
                {% if form.eye_color.errors %}
                    {% for error in form.eye_color.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- Hair Color Dropdown -->
            <div class="id-form-section">
                <label class="id-form-label">Hair Color <span class="required">*</span></label>
                {{ form.hair_color(class="id-form-select") }}
                {% if form.hair_color.errors %}
                    {% for error in form.hair_color.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- Date of Birth -->
            <div class="id-form-section">
                <label class="id-form-label">Birthday (the date you want displayed on your ID) <span class="required">*</span></label>
                {{ form.date_of_birth(class="id-form-input", type="date") }}
                {% if form.date_of_birth.errors %}
                    {% for error in form.date_of_birth.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- Address (Optional) -->
            <div class="id-form-section">
                <label class="id-form-label">Street Address</label>
                {{ form.address(class="id-form-input", placeholder="Street Address (Optional)") }}
                <p class="form-helper-text">Leave empty if you'd like administrative staff to complete this field</p>
                {% if form.address.errors %}
                    {% for error in form.address.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>
            <!-- City and Zip Code -->
            <div class="id-form-row">
                <div class="id-form-field">
                    <label class="id-form-label">City <span class="required">*</span></label>
                    {{ form.city(class="id-form-input", placeholder="City") }}
                    {% if form.city.errors %}
                        {% for error in form.city.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="id-form-field">
                    <label class="id-form-label">Zip Code <span class="required">*</span></label>
                    {{ form.zip_code(class="id-form-input", placeholder="ZIP/Postal Code") }}
                    {% if form.zip_code.errors %}
                        {% for error in form.zip_code.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
            <!-- Organ Donor and Restrictions -->
            <div class="id-form-row" style="grid-template-columns: 1fr 1fr;">
                <div class="id-form-field">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label class="id-form-label" style="margin-bottom: 0;">Organ Donor</label>
                        {{ form.organ_donor(style="width: 20px; height: 20px; cursor: pointer;") }}
                    </div>
                    {% if form.organ_donor.errors %}
                        {% for error in form.organ_donor.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="id-form-field">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label class="id-form-label" style="margin-bottom: 0;">Restrictions (Corrective Lenses)</label>
                        {{ form.restrictions_corrective_lenses(style="width: 20px; height: 20px; cursor: pointer;") }}
                    </div>
                    {% if form.restrictions_corrective_lenses.errors %}
                        {% for error in form.restrictions_corrective_lenses.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- Submit Button (Full Width Below) -->
        <div class="id-form-submit">
            {{ form.submit(class="id-form-submit-btn") }}
        </div>
    </form>
</div>

<script>
    // File upload label update and image preview
    const fileInput = document.querySelector('.file-input');
    const fileName = document.querySelector('.file-name');
    const imagePreview = document.getElementById('image-preview');
    const imagePreviewContainer = document.getElementById('image-preview-container');

    if (fileInput) {
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                fileName.textContent = file.name;

                // Show image preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreviewContainer.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                // Hide preview if no file selected
                imagePreviewContainer.style.display = 'none';
                fileName.textContent = 'No file chosen';
            }
        });
    }

    // Height conversion from feet/inches to cm
    const heightFeet = document.getElementById('height-feet');
    const heightInches = document.getElementById('height-inches');
    const heightCmHidden = document.getElementById('height-cm-hidden');

    function updateHeightCm() {
        const feet = parseFloat(heightFeet.value) || 0;
        const inches = parseFloat(heightInches.value) || 0;

        // Convert to total inches, then to cm (1 inch = 2.54 cm)
        const totalInches = (feet * 12) + inches;
        const cm = totalInches * 2.54;

        heightCmHidden.value = cm.toFixed(2);
    }

    if (heightFeet && heightInches) {
        heightFeet.addEventListener('input', updateHeightCm);
        heightInches.addEventListener('input', updateHeightCm);
    }
</script>
{% endblock %}