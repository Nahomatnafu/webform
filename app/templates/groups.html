{% extends "base.html" %}

{% block content %}
<style>
    textarea.form-field-input {
        resize: none;
        overflow: hidden;
        height: 44px;
        padding: 12px 14px;
        line-height: 1.2;
    }
</style>
<div class="dashboard-container">
    <!-- Create Group Section -->
    <div class="dashboard-section">
        <h2 class="section-title">Create New Group</h2>
        <p class="section-subtitle">Set up a new group for collecting forms with capacity and expiration settings.</p>

        <form method="POST" novalidate>
            {{ form.hidden_tag() }}

            <div class="form-section">
                <div class="form-field">
                    <label class="form-field-label">{{ form.name.label.text }} <span class="required">*</span></label>
                    {{ form.name(class="form-field-input", placeholder="e.g., Group 1, Event A") }}
                    {% if form.name.errors %}
                        {% for error in form.name.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-field">
                    <label class="form-field-label">{{ form.description.label.text }}</label>
                    {{ form.description(class="form-field-input", placeholder="Optional description") }}
                    {% if form.description.errors %}
                        {% for error in form.description.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-field">
                    <label class="form-field-label">{{ form.max_capacity.label.text }} <span class="required">*</span></label>
                    {{ form.max_capacity(class="form-field-input", placeholder="0 for unlimited", value=form.max_capacity.data or 0) }}
                    {% if form.max_capacity.errors %}
                        {% for error in form.max_capacity.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-field">
                    <label class="form-field-label">{{ form.expiration_type.label.text }} <span class="required">*</span></label>
                    {{ form.expiration_type(class="form-field-input") }}
                    {% if form.expiration_type.errors %}
                        {% for error in form.expiration_type.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-field">
                    <label class="form-field-label">{{ form.expiration_hours.label.text }}</label>
                    {{ form.expiration_hours(class="form-field-input", placeholder="48", value=form.expiration_hours.data or 48) }}
                    {% if form.expiration_hours.errors %}
                        {% for error in form.expiration_hours.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>

            {{ form.submit(class="btn-generate-link") }}
        </form>
    </div>

    <!-- Groups List Section -->
    <div class="dashboard-section">
        <h2 class="section-title">Your Groups</h2>

        {% if groups %}
        <table class="dashboard-table">
            <thead>
                <tr>
                    <th>Group Name</th>
                    <th>Capacity</th>
                    <th>Submissions</th>
                    <th>Expiration</th>
                    <th>Created</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for group in groups %}
                <tr>
                    <td>
                        <strong>{{ group.name }}</strong>
                        {% if group.description %}
                            <br><small style="color: #999;">{{ group.description[:50] }}{% if group.description|length > 50 %}...{% endif %}</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if group.max_capacity == 0 %}
                            Unlimited
                        {% else %}
                            {{ group.current_count }}/{{ group.max_capacity }}
                        {% endif %}
                    </td>
                    <td>{{ group.current_count }}</td>
                    <td>
                        {% if group.expiration_type == 'never' %}
                            Never
                        {% else %}
                            {{ group.expiration_hours }} hours
                        {% endif %}
                    </td>
                    <td>{{ moment(group.created_at).format('MMM DD, YYYY') }}</td>
                    <td>
                        <a href="{{ url_for('main.view_group', group_id=group.id) }}" class="btn-view-form">Manage</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
        {% if prev_url or next_url %}
        <div class="pagination-container">
            {% if prev_url %}
                <a href="{{ prev_url }}" class="pagination-btn">← Back</a>
            {% else %}
                <button class="pagination-btn" disabled>← Back</button>
            {% endif %}

            {% if next_url %}
                <a href="{{ next_url }}" class="pagination-btn">Next →</a>
            {% else %}
                <button class="pagination-btn" disabled>Next →</button>
            {% endif %}
        </div>
        {% endif %}
        {% else %}
        <p style="text-align: center; color: #999; padding: 40px 0;">No groups created yet. Create one above!</p>
        {% endif %}
    </div>
</div>

<script>
    // Auto-expand textarea as user types
    const textarea = document.querySelector('textarea.form-field-input');
    if (textarea) {
        function autoExpand() {
            textarea.style.height = 'auto';
            textarea.style.height = Math.max(textarea.scrollHeight, 40) + 'px';
        }

        textarea.addEventListener('input', autoExpand);
        textarea.addEventListener('change', autoExpand);

        // Initial expansion if there's already content
        autoExpand();
    }
</script>
{% endblock %}

